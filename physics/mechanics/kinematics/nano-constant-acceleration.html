<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Constant Acceleration – PromptSchola Physics</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta
    name="description"
    content="Nano-lesson on constant acceleration in 1D motion: definition, intuition, real-world connections, quiz, summary & reflection, and exploration/simulation."
  />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Lora:ital,wght@0,600;0,700;1,500&display=swap" rel="stylesheet">

  <script>
    window.MathJax = {
      tex: { inlineMath: [['\\(','\\)'], ['$', '$']], displayMath: [['\\[','\\]'], ['$$','$$']] },
      svg: { fontCache: 'global' }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"></script>

  <style>
    :root {
      --bg-body: #f3f4f6;
      --bg-surface: #f9fafb;
      --bg-card: #ffffff;

      --accent: #7e22ce;
      --accent-strong: #6d28d9;
      --accent-soft: rgba(126, 34, 206, 0.09);
      --accent-soft2: rgba(129, 140, 248, 0.12);

      --text-main: #111827;
      --text-muted: #4b5563;
      --text-subtle: #9ca3af;
      --text-strong: #020617;

      --border-subtle: rgba(209, 213, 219, 0.55);
      --radius-card: 18px;
      --radius-pill: 999px;
      --shadow-soft: 0 18px 40px rgba(15, 23, 42, 0.12);
      --shadow-card: 0 16px 35px rgba(15, 23, 42, 0.12);

      --font-heading: 'Lora', serif;
      --font-body: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;

      --transition-fast: 0.25s ease-out;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    a { text-decoration: none; color: inherit; }

    body {
      font-family: var(--font-body);
      background: radial-gradient(circle at top, #e5e7eb, #f9fafb 45%, #f3f4f6);
      color: var(--text-main);
      line-height: 1.7;
      -webkit-font-smoothing: antialiased;
      font-size: 16.5px;
      letter-spacing: -0.01em;
      overflow-x: hidden;
    }

    h1, h2, h3 {
      font-family: var(--font-heading);
      color: var(--text-strong);
      line-height: 1.15;
    }

    .page { min-height: 100vh; display: flex; flex-direction: column; }
    .container { width: 100%; max-width: 1120px; margin: 0 auto; padding: 0 1.4rem; }

    header {
      position: sticky; top: 0; z-index: 40;
      backdrop-filter: blur(14px);
      background: linear-gradient(
        to bottom,
        rgba(249, 250, 251, 0.96),
        rgba(249, 250, 251, 0.94),
        rgba(249, 250, 251, 0.9)
      );
      border-bottom: 1px solid rgba(209, 213, 219, 0.9);
    }

    .nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 0;
      gap: 1rem;
    }

    .nav-left { display:flex; align-items:center; gap:0.75rem; }

    .logo-mark {
      width: 34px; height: 34px; border-radius: 40%;
      background: radial-gradient(circle at 30% 30%, var(--accent), var(--accent-strong));
      display: flex; align-items: center; justify-content: center;
      font-weight: 800; font-size: 1rem; color: #f9fafb;
      font-family: var(--font-body);
    }

    .logo-text span:first-child {
      display: block; font-weight: 700; font-size: 1.02rem;
      letter-spacing: 0.02em; color: var(--text-strong);
      font-family: var(--font-body); line-height: 1.1;
    }

    .logo-text span:last-child {
      display: block; font-size: 0.76rem; color: var(--text-subtle);
      font-family: var(--font-body);
    }

    .nav-links {
      display: flex; align-items: center; gap: 1.3rem;
      font-size: 0.95rem;
    }

    .nav-links a {
      color: var(--text-muted); opacity: 0.9;
      transition: opacity var(--transition-fast), color var(--transition-fast);
      font-family: var(--font-body);
    }
    .nav-links a:hover { opacity: 1; color: var(--accent-strong); }

    .nav-right {
      display: flex; align-items: center; gap: 0.6rem;
      font-size: 0.9rem; font-family: var(--font-body);
      flex-wrap: wrap; justify-content: flex-end;
    }

    .btn-pill {
      border-radius: var(--radius-pill);
      padding: 0.45rem 0.95rem;
      font-size: 0.86rem;
      border: 1px solid rgba(209, 213, 219, 0.9);
      background: #ffffff;
      color: var(--text-main);
      cursor: pointer;
      transition: background var(--transition-fast), transform var(--transition-fast), box-shadow var(--transition-fast), border-color var(--transition-fast);
      font-family: var(--font-body);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      white-space: nowrap;
    }
    .btn-pill:hover {
      background: #f3f4f6;
      transform: translateY(-1px);
      border-color: rgba(156, 163, 175, 0.9);
      box-shadow: 0 8px 20px rgba(148, 163, 184, 0.35);
    }

    .btn-primary {
      border-radius: var(--radius-pill);
      padding: 0.6rem 1.3rem;
      font-size: 0.9rem;
      font-weight: 600;
      border: none;
      cursor: pointer;
      background: radial-gradient(circle at 30% 0%, #a855f7, #7e22ce, #4c1d95);
      color: #f9fafb;
      box-shadow: none;
      transition: transform var(--transition-fast), filter var(--transition-fast), background var(--transition-fast);
      font-family: var(--font-body);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.35rem;
      white-space: nowrap;
    }
    .btn-primary:hover {
      transform: translateY(-1px);
      filter: brightness(1.03);
      background: radial-gradient(circle at 30% 0%, #c084fc, #7e22ce, #4c1d95);
    }

    .btn-primary[disabled],
    .btn-pill[disabled],
    .btn-ghost[disabled] {
      opacity: 0.55;
      cursor: not-allowed;
      transform: none !important;
      filter: none !important;
      box-shadow: none !important;
    }

    .btn-ghost {
      padding: 0.42rem 0.9rem;
      border-radius: var(--radius-pill);
      font-size: 0.82rem;
      border: 1px solid rgba(209, 213, 219, 0.9);
      background: #ffffff;
      cursor: pointer;
      transition: var(--transition-fast);
      font-family: var(--font-body);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.25rem;
      white-space: nowrap;
    }
    .btn-ghost:hover { background: #f3f4f6; transform: translateY(-1px); }
    .btn-copy { font-size: 0.78rem; padding: 0.32rem 0.85rem; }

    .hero {
      padding: 4.0rem 0 2.2rem;
      position: relative;
      overflow: hidden;
      text-align: center;
    }

    .hero::before {
      content: "";
      position: absolute;
      inset: -80px;
      pointer-events: none;
      background:
        radial-gradient(circle at 10% 0%, rgba(129, 140, 248, 0.40), transparent 60%),
        radial-gradient(circle at 90% 40%, rgba(168, 85, 247, 0.35), transparent 55%);
      opacity: 0.9;
      z-index: -1;
    }

    .hero-kicker {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--accent-strong);
      font-weight: 700;
      margin-bottom: 1.05rem;
      font-family: var(--font-body);
    }

    .hero-kicker span.label {
      padding: 0.18rem 0.7rem;
      border-radius: 8px;
      border: 1px solid rgba(129, 140, 248, 0.22);
      background: var(--accent-soft2);
      color: var(--accent-strong);
      font-weight: 800;
      letter-spacing: 0.14em;
      font-family: var(--font-body);
    }

    .hero-title {
      font-size: clamp(2.2rem, 4vw, 2.9rem);
      line-height: 1.12;
      font-weight: 700;
      margin: 0 auto 0.85rem;
      max-width: 56rem;
      color: var(--text-strong);
    }

    .hero-subtitle {
      font-size: 1.10rem;
      max-width: 48rem;
      color: var(--text-muted);
      margin: 0 auto;
      line-height: 1.6;
      font-family: var(--font-body);
    }

    .hero-breadcrumbs {
      margin-top: 0.95rem;
      font-size: 0.86rem;
      color: var(--text-subtle);
      font-family: var(--font-body);
    }
    .hero-breadcrumbs a { color: var(--accent-strong); }

    .access-band {
      background: #0f172a;
      color: #f8fafc;
      border-radius: 28px;
      padding: 1.55rem 1.5rem;
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(148, 163, 184, 0.18);
      box-shadow: var(--shadow-soft);
      max-width: 980px;
      margin: 0 auto;
    }

    .access-band::before {
      content: "";
      position: absolute;
      inset: -120px;
      pointer-events: none;
      background:
        radial-gradient(circle at 15% 25%, rgba(168, 85, 247, 0.22), transparent 60%),
        radial-gradient(circle at 80% 30%, rgba(129, 140, 248, 0.20), transparent 58%);
      filter: blur(16px);
      opacity: 0.9;
    }

    .access-band-inner {
      position: relative;
      z-index: 1;
      display: flex;
      gap: 1.2rem;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .access-band-title {
      font-family: var(--font-heading);
      font-size: 1.35rem;
      color: #ffffff;
      margin-bottom: 0.2rem;
      font-weight: 700;
    }

    .access-band-desc {
      font-family: var(--font-body);
      color: #cbd5e1;
      font-size: 0.98rem;
      line-height: 1.6;
      max-width: 52rem;
    }

    .access-chips { display: flex; gap: 0.55rem; flex-wrap: wrap; align-items: center; }

    .chip {
      display: inline-flex;
      align-items: center;
      font-weight: 800;
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 0.22rem 0.6rem;
      border-radius: 6px;
      font-family: var(--font-body);
      white-space: nowrap;
    }
    .chip.free { background: #10b981; color: #ffffff; }
    .chip.mastery { background: #6366f1; color: #ffffff; }

    main { padding-bottom: 2.6rem; }
    section { padding: 1.4rem 0; }

    .lesson-layout {
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(280px, 1.1fr);
      gap: 1.5rem;
      align-items: flex-start;
      margin-top: 0.8rem;
    }

    .steps-grid { display: grid; grid-template-columns: 1fr; gap: 1rem; }

    .step-card {
      background: var(--bg-card);
      border-radius: var(--radius-card);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-card);
      display: flex;
      flex-direction: column;
      gap: 0.7rem;
      font-size: 0.95rem;
      border-left: 4px solid rgba(126, 34, 206, 0.55);
      padding: 1rem 1.15rem 1.05rem;
    }

    .step-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.75rem;
    }

    .step-header-left { display: flex; flex-direction: column; gap: 0.25rem; min-width: 0; }

    .step-index {
      font-size: 0.74rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #4c1d95;
      background: #ede9fe;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      padding: 0.16rem 0.7rem;
      font-weight: 800;
      font-family: var(--font-body);
      width: fit-content;
    }

    .step-title {
      font-size: 1.06rem;
      font-weight: 700;
      color: #111827;
      font-family: var(--font-heading);
      line-height: 1.25;
      word-break: break-word;
    }

    .step-header-right { display: flex; align-items: center; gap: 0.45rem; flex-wrap: wrap; justify-content: flex-end; }

    .step-access-pill {
      padding: 0.15rem 0.6rem;
      border-radius: var(--radius-pill);
      font-size: 0.72rem;
      border: 1px solid rgba(22, 163, 74, 0.9);
      background: #dcfce7;
      color: #166534;
      white-space: nowrap;
      font-family: var(--font-body);
      font-weight: 700;
    }
    .step-access-pill.mastery {
      border-color: rgba(99, 102, 241, 0.9);
      background: rgba(99, 102, 241, 0.12);
      color: #3730a3;
    }

    .toggle-btn {
      width: 30px; height: 30px;
      border-radius: 999px;
      border: 1px solid rgba(129, 140, 248, 0.8);
      background: #eef2ff;
      color: #4c1d95;
      font-size: 1.2rem;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      padding: 0;
      box-shadow: 0 3px 7px rgba(148, 163, 184, 0.5);
      transition: transform 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
      font-family: var(--font-body);
    }
    .toggle-btn:hover { transform: translateY(-1px) scale(1.07); box-shadow: 0 5px 12px rgba(129, 140, 248, 0.75); background: #e0e7ff; }

    .step-content { margin-top: 0.35rem; display: block; }

    .step-body {
      font-size: 0.92rem;
      color: var(--text-muted);
      font-family: var(--font-body);
      line-height: 1.7;
    }

    .prompt-preview {
      margin-top: 0.45rem;
      padding: 0.55rem 0.65rem;
      border-radius: 12px;
      background: #f9fafb;
      border: 1px solid rgba(229, 231, 235, 0.8);
      font-size: 0.83rem;
      color: var(--text-subtle);
      font-family: var(--font-body);
      min-height: 2.2rem;
      white-space: pre-wrap;
      display: none;
    }

    .ai-response {
      margin-top: 0.6rem;
      padding: 1.05rem 1.15rem;
      border-radius: 14px;
      background: #ffffff;
      border: 1px solid rgba(129, 140, 248, 0.35);
      font-size: 0.98rem;
      color: #111827;
      white-space: pre-wrap;
      line-height: 1.75;
      font-family: var(--font-body);
      min-height: 1.2rem;
    }

    .ai-response p { margin-bottom: 0.9rem; }
    .ai-response ul, .ai-response ol { margin: 0.7rem 0 0.7rem 1.3rem; }
    .ai-response strong { font-weight: 800; color: inherit; }
    .ai-response em { font-style: italic; }

    /* Step 4 answer toggles */
    .ai-response details.answer-toggle {
      margin: 0.55rem 0 0.75rem;
      border: 1px solid rgba(209, 213, 219, 0.85);
      background: #f9fafb;
      border-radius: 12px;
      overflow: hidden;
    }
    .ai-response details.answer-toggle summary {
      list-style: none;
      cursor: pointer;
      padding: 0.55rem 0.75rem;
      font-weight: 800;
      color: #4c1d95;
      background: linear-gradient(to bottom, rgba(126, 34, 206, 0.06), rgba(129, 140, 248, 0.06));
      border-bottom: 1px solid rgba(209, 213, 219, 0.7);
      font-size: 0.9rem;
    }
    .ai-response details.answer-toggle summary::-webkit-details-marker { display:none; }
    .ai-response .answer-body {
      padding: 0.75rem 0.85rem 0.85rem;
      color: #111827;
      font-size: 0.95rem;
      line-height: 1.7;
    }
    .ai-response .answer-body .mini-note {
      margin-top: 0.45rem;
      padding: 0.55rem 0.65rem;
      border-radius: 12px;
      border: 1px solid rgba(129, 140, 248, 0.32);
      background: rgba(129, 140, 248, 0.08);
      color: var(--text-muted);
      font-size: 0.86rem;
      line-height: 1.55;
    }

    .copy-row {
      margin-top: 0.55rem;
      display: flex;
      justify-content: flex-end;
      gap: 0.45rem;
      flex-wrap: wrap;
    }

    .step-footer {
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid rgba(209, 213, 219, 0.7);
      display: flex;
      justify-content: space-between;
      gap: 0.6rem;
      align-items: center;
      font-size: 0.82rem;
      color: var(--text-subtle);
      flex-wrap: wrap;
      font-family: var(--font-body);
    }

    .step-footer .left-actions { display: flex; gap: 0.45rem; flex-wrap: wrap; align-items: center; }

    .locked-panel {
      margin-top: 0.55rem;
      border-radius: 16px;
      border: 1px solid rgba(99, 102, 241, 0.35);
      background: linear-gradient(to bottom, rgba(99, 102, 241, 0.08), rgba(126, 34, 206, 0.06));
      padding: 0.95rem 1rem;
      color: #111827;
      font-family: var(--font-body);
    }
    .locked-title { font-family: var(--font-heading); font-size: 1.05rem; color: var(--text-strong); margin-bottom: 0.25rem; font-weight: 700; }
    .locked-desc { color: var(--text-muted); font-size: 0.92rem; line-height: 1.65; margin-bottom: 0.7rem; }
    .locked-actions { display: flex; gap: 0.5rem; flex-wrap: wrap; }

    .help-panel-inner { position: sticky; top: 6rem; }

    .help-panel-toggle {
      width: 100%;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(209, 213, 219, 0.9);
      background: radial-gradient(circle at 0 0, #f9fafb, #eef2ff);
      color: var(--text-main);
      padding: 0.45rem 0.95rem;
      font-size: 0.82rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      margin-bottom: 0.6rem;
      box-shadow: 0 6px 16px rgba(148, 163, 184, 0.3);
      font-family: var(--font-body);
    }

    .nano-help-title {
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
      padding: 0.12rem 0.6rem;
      border-radius: 999px;
      border: 1px solid rgba(126, 34, 206, 0.35);
      color: #4c1d95;
      background: rgba(126, 34, 206, 0.06);
      font-size: 0.8rem;
      font-weight: 900;
      font-family: var(--font-body);
    }

    .help-panel-toggle-icon { font-size: 0.95rem; opacity: 0.85; }

    /* Wrap to allow a true lock overlay without breaking layout/JS */
    .help-lock-wrap { position: relative; }

    .help-panel-body {
      border-radius: 1.1rem;
      border: 1px solid rgba(209, 213, 219, 0.9);
      background: radial-gradient(circle at 0 0, #ffffff, #eef2ff);
      box-shadow: 0 16px 35px rgba(15, 23, 42, 0.16);
      padding: 0.9rem 0.95rem;
      font-size: 0.82rem;
      font-family: var(--font-body);
      position: relative;
      overflow: hidden;
    }

    .help-panel-body p { color: var(--text-muted); line-height: 1.65; }

    /* CTA inside panel (still used for paid messaging if you ever want it) */
    .help-cta {
      margin-top: 0.65rem;
      padding: 0.7rem 0.75rem;
      border-radius: 14px;
      border: 1px solid rgba(99, 102, 241, 0.35);
      background: linear-gradient(to bottom, rgba(15, 23, 42, 0.92), rgba(15, 23, 42, 0.88));
      color: #f8fafc;
      box-shadow: 0 16px 35px rgba(15, 23, 42, 0.18);
      display: none;
    }
    .help-cta .kicker {
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-weight: 900;
      color: #c7d2fe;
      margin-bottom: 0.35rem;
      font-family: var(--font-body);
    }
    .help-cta .title {
      font-family: var(--font-heading);
      font-size: 1.02rem;
      line-height: 1.2;
      margin-bottom: 0.25rem;
      font-weight: 700;
      color: #ffffff;
    }
    .help-cta .desc {
      font-size: 0.9rem;
      color: #cbd5e1;
      line-height: 1.55;
      margin-bottom: 0.65rem;
      font-family: var(--font-body);
    }
    .help-cta .actions { display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: center; }

    .help-category {
      padding-top: 0.65rem;
      border-top: 1px solid rgba(209, 213, 219, 0.7);
      margin-top: 0.65rem;
    }
    .help-category:first-of-type { border-top: none; margin-top: 0; padding-top: 0; }

    .help-category-label {
      display: inline-flex;
      align-items: center;
      padding: 0.12rem 0.55rem;
      border-radius: 999px;
      border: 1px solid rgba(129, 140, 248, 0.8);
      background: #eef2ff;
      font-size: 0.72rem;
      color: var(--accent-strong);
      font-family: var(--font-body);
      font-weight: 900;
    }

    .help-category-desc { margin: 0.28rem 0 0; font-size: 0.78rem; color: var(--text-subtle); font-family: var(--font-body); }

    .help-prompts-bulleted {
      margin-top: 0.4rem;
      padding-left: 1.5rem;
      list-style-type: disc;
      list-style-position: outside;
    }
    .help-prompts-bulleted li { margin-bottom: 0.35rem; }
    .help-prompts-bulleted li::marker { font-size: 1.15em; color: #4c1d95; }

    .help-prompt-btn {
      display: block;
      width: 100%;
      text-align: left;
      padding: 0.4rem 0.2rem;
      font-size: 0.84rem;
      border-radius: 10px;
      background: transparent;
      color: #6b21a8;
      border: none;
      cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease, text-decoration-color 0.2s ease;
      font-family: var(--font-body);
    }
    .help-prompt-btn:hover { background: rgba(76, 29, 149, 0.07); color: #4c1d95; text-decoration: underline; }

    footer {
      margin-top: auto;
      padding: 1.8rem 0 2.1rem;
      text-align: center;
      font-size: 0.86rem;
      color: var(--text-subtle);
      font-family: var(--font-body);
    }

    @media (max-width: 980px) {
      .lesson-layout { grid-template-columns: minmax(0, 1fr); }
      .help-panel-inner { position: static; }
      .help-panel-toggle { margin-top: 1.25rem; }
    }
    @media (max-width: 860px) { .nav-links { display: none; } }

    /* =========================================================
       NEW: HARD LOCK FOR HELP PANEL (anon + free)
       ========================================================= */
    .help-lock-disabled {
      pointer-events: none; /* block ALL clicks inside wrapper */
      user-select: none;
      opacity: 0.92;
      filter: grayscale(0.08);
    }

    .help-lock-overlay {
      position: absolute;
      inset: 0;
      border-radius: 1.1rem;
      background: linear-gradient(to bottom, rgba(249,250,251,0.55), rgba(249,250,251,0.88));
      border: 1px dashed rgba(99, 102, 241, 0.55);
      display: none; /* shown via JS when locked */
      align-items: flex-start;
      justify-content: center;
      padding: 0.85rem 0.85rem;
      z-index: 5;
    }

    .help-lock-overlay .teaser-card {
      width: 100%;
      border-radius: 14px;
      background: rgba(15, 23, 42, 0.94);
      color: #f8fafc;
      border: 1px solid rgba(148, 163, 184, 0.22);
      padding: 0.85rem 0.9rem;
      box-shadow: 0 16px 35px rgba(15, 23, 42, 0.22);
    }

    .teaser-kicker {
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
      font-size: 0.74rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-weight: 900;
      color: #c7d2fe;
      margin-bottom: 0.35rem;
    }
    .teaser-title {
      font-family: var(--font-heading);
      font-size: 1.05rem;
      line-height: 1.2;
      margin-bottom: 0.25rem;
      font-weight: 700;
      color: #ffffff;
    }
    .teaser-desc {
      font-size: 0.9rem;
      color: #cbd5e1;
      line-height: 1.55;
      margin-bottom: 0.7rem;
    }
    .teaser-actions { display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: center; }

    /* When locked, also disable the toggle button itself (visual + cursor) */
    .help-toggle-disabled {
      opacity: 0.75;
      cursor: not-allowed;
    }

    /* =========================================================
       ROYAL BLUE HELP PANEL THEME (scoped override)
       ========================================================= */
    :root{
      --help-blue: #2563eb;
      --help-blue-strong: #1d4ed8;
      --help-blue-soft: rgba(37, 99, 235, 0.10);
      --help-blue-soft2: rgba(59, 130, 246, 0.14);
      --help-blue-ink: #0b1220;
    }

    .help-panel-toggle{
      border: 1px solid rgba(37, 99, 235, 0.28);
      background: radial-gradient(circle at 0 0, #f9fafb, rgba(37, 99, 235, 0.10));
      box-shadow: 0 6px 16px rgba(37, 99, 235, 0.12);
    }

    .nano-help-title{
      border: 1px solid rgba(37, 99, 235, 0.32);
      color: var(--help-blue-strong);
      background: rgba(37, 99, 235, 0.06);
    }

    .help-panel-body{
      border: 1px solid rgba(37, 99, 235, 0.22);
      background: radial-gradient(circle at 0 0, #ffffff, rgba(37, 99, 235, 0.08));
      box-shadow: 0 16px 35px rgba(37, 99, 235, 0.10);
    }

    .help-category-label{
      border: 1px solid rgba(37, 99, 235, 0.35);
      background: rgba(37, 99, 235, 0.10);
      color: var(--help-blue-strong);
    }

    .help-prompts-bulleted li::marker{
      color: var(--help-blue-strong);
    }

    .help-prompt-btn{
      color: var(--help-blue-strong);
    }
    .help-prompt-btn:hover{
      background: rgba(37, 99, 235, 0.08);
      color: #0b1220;
      text-decoration: underline;
    }

    .help-lock-overlay{
      border-color: rgba(37, 99, 235, 0.45);
    }
  </style>
</head>

<body>
<div class="page">

  <header>
    <div class="container">
      <div class="nav">
        <div class="nav-left">
          <div class="logo-mark">P</div>
          <div class="logo-text">
            <span>PromptSchola</span>
            <span>Prompt-based STEM subjects mastery</span>
          </div>
        </div>

        <nav class="nav-links">
          <a href="/index.html">Home</a>
          <a href="/physics/physics.html">Physics</a>
          <a href="/math/math.html">Math</a>
          <a href="/chemistry/chemistry.html">Chemistry</a>
          <a href="/biology/biology.html">Biology</a>
          <a href="/pricing.html">Pricing</a>
        </nav>

        <div class="nav-right">
          <span id="nav-user" style="font-size:0.78rem;color:#9ca3af;"></span>

          <a id="nav-login-btn" href="/auth.html" class="btn-pill" onclick="PS_setPostAuthRedirect && PS_setPostAuthRedirect()">
            Sign In
          </a>

          <a id="nav-register-btn" href="/auth.html?mode=signup" class="btn-primary" onclick="PS_setPostAuthRedirect && PS_setPostAuthRedirect()">
            Register for Free
          </a>

          <button
            id="nav-signout-btn"
            type="button"
            class="btn-pill"
            style="display:none;"
            onclick="signOutUser && signOutUser()"
          >
            Sign out
          </button>
        </div>
      </div>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="container">
        <div class="hero-kicker">
          <span class="label">Nano</span>
          <span>Physics · Mechanics · Kinematics (1D)</span>
        </div>

        <h1 class="hero-title">Constant Acceleration</h1>

        <p class="hero-subtitle">
          Learn what it truly means for acceleration to be constant, how it shapes motion graphs, and how to
          solve 1D motion problems with confidence (final-year high school + first-year university).
        </p>

        <div class="hero-breadcrumbs">
          <a href="/physics/physics.html">Physics</a> ·
          <a href="/physics/mechanics.html">Mechanics</a> ·
          <a href="/physics/kinematics-in-one-dimension.html">Kinematics in 1D</a> ·
          <span>Constant Acceleration</span>
        </div>
      </div>
    </section>

    <section>
      <div class="container">
        <div class="access-band">
          <div class="access-band-inner">
            <div>
              <div class="access-band-title">Access for this nano-lesson</div>
              <div class="access-band-desc">
                Unsigned visitors can <strong>show &amp; copy prompts</strong> for Steps 1–3.
                Signed-in free accounts can also <strong>Run with AI</strong> for Steps 1–2.
                Paid accounts unlock everything (Steps 1–6 + Help prompts + AI).
              </div>
            </div>
            <div class="access-chips">
              <span class="chip free">Steps 1–3 Free</span>
              <span class="chip mastery">Steps 4–6 Paid</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section>
      <div class="container">
        <div class="lesson-layout">

          <div class="lesson-main">
            <div class="steps-grid">

              <!-- STEP 1 -->
              <article class="step-card" data-step="1">
                <div class="step-header">
                  <div class="step-header-left">
                    <div class="step-index">STEP 1</div>
                    <div class="step-title">Orient / Definition: what does “constant acceleration” mean?</div>
                  </div>
                  <div class="step-header-right">
                    <span class="step-access-pill">Free</span>
                    <button class="toggle-btn" id="toggle-btn-1" onclick="toggleStep(1)">−</button>
                  </div>
                </div>

                <div class="step-content" id="step-content-1">
                  <div class="step-unlocked" id="step-unlocked-1">
                    <div class="step-body">
                      Build a crisp definition, connect it to velocity change, and set sign conventions
                      (positive direction) so later equations feel logical.
                    </div>

                    <div class="prompt-preview" id="preview-step1">Prompt preview will appear here.</div>
                    <div class="ai-response" id="response-step1"></div>

                    <div class="copy-row">
                      <button class="btn-ghost btn-copy" onclick="copyPrompt(1)">Copy prompt</button>
                      <button class="btn-ghost btn-copy" id="copy-answer-1" onclick="copyAnswer(1)" style="display:none;">Copy answer</button>
                    </div>

                    <div class="step-footer">
                      <div class="left-actions">
                        <button class="btn-ghost" onclick="showPrompt(1)">Show prompt</button>
                        <button class="btn-primary" id="run-btn-1" type="button">Run with AI</button>
                      </div>
                      <span>Goal: define it so clearly you can explain it in one sentence.</span>
                    </div>
                  </div>

                  <div class="locked-panel" id="step-locked-1" style="display:none;">
                    <div class="locked-title">Locked</div>
                    <div class="locked-desc">This step is not available for your account level.</div>
                    <div class="locked-actions">
                      <a class="btn-primary" href="/pricing.html">View plans</a>
                      <a class="btn-pill" href="/auth.html" onclick="PS_setPostAuthRedirect && PS_setPostAuthRedirect()">Sign In</a>
                    </div>
                  </div>
                </div>
              </article>

              <!-- STEP 2 -->
              <article class="step-card" data-step="2">
                <div class="step-header">
                  <div class="step-header-left">
                    <div class="step-index">STEP 2</div>
                    <div class="step-title">Conceptual grounding: stories + graphs (v–t, a–t, x–t)</div>
                  </div>
                  <div class="step-header-right">
                    <span class="step-access-pill">Free</span>
                    <button class="toggle-btn" id="toggle-btn-2" onclick="toggleStep(2)">−</button>
                  </div>
                </div>

                <div class="step-content" id="step-content-2">
                  <div class="step-unlocked" id="step-unlocked-2">
                    <div class="step-body">
                      Build intuition using everyday motion (car speeding up, free-fall, thrown up then down),
                      and connect “constant a” to the shapes of graphs.
                    </div>

                    <div class="prompt-preview" id="preview-step2">Prompt preview will appear here.</div>
                    <div class="ai-response" id="response-step2"></div>

                    <div class="copy-row">
                      <button class="btn-ghost btn-copy" onclick="copyPrompt(2)">Copy prompt</button>
                      <button class="btn-ghost btn-copy" id="copy-answer-2" onclick="copyAnswer(2)" style="display:none;">Copy answer</button>
                    </div>

                    <div class="step-footer">
                      <div class="left-actions">
                        <button class="btn-ghost" onclick="showPrompt(2)">Show prompt</button>
                        <button class="btn-primary" id="run-btn-2" type="button">Run with AI</button>
                      </div>
                      <span>Goal: know what each graph must look like before doing any math.</span>
                    </div>
                  </div>

                  <div class="locked-panel" id="step-locked-2" style="display:none;">
                    <div class="locked-title">Locked</div>
                    <div class="locked-desc">This step is not available for your account level.</div>
                    <div class="locked-actions">
                      <a class="btn-primary" href="/pricing.html">View plans</a>
                      <a class="btn-pill" href="/auth.html" onclick="PS_setPostAuthRedirect && PS_setPostAuthRedirect()">Sign In</a>
                    </div>
                  </div>
                </div>
              </article>

              <!-- STEP 3 -->
              <article class="step-card" data-step="3">
                <div class="step-header">
                  <div class="step-header-left">
                    <div class="step-index">STEP 3</div>
                    <div class="step-title">Real-world connection: when is acceleration “approximately constant”?</div>
                  </div>
                  <div class="step-header-right">
                    <span class="step-access-pill">Free</span>
                    <button class="toggle-btn" id="toggle-btn-3" onclick="toggleStep(3)">−</button>
                  </div>
                </div>

                <div class="step-content" id="step-content-3">
                  <div class="step-unlocked" id="step-unlocked-3">
                    <div class="step-body">
                      Learn when the constant-acceleration model is valid (or not): free-fall near Earth,
                      braking, ramps, air resistance, and “average acceleration” vs “instantaneous acceleration.”
                    </div>

                    <div class="prompt-preview" id="preview-step3">Prompt preview will appear here.</div>
                    <div class="ai-response" id="response-step3"></div>

                    <div class="copy-row">
                      <button class="btn-ghost btn-copy" onclick="copyPrompt(3)">Copy prompt</button>
                      <button class="btn-ghost btn-copy" id="copy-answer-3" onclick="copyAnswer(3)" style="display:none;">Copy answer</button>
                    </div>

                    <div class="step-footer">
                      <div class="left-actions">
                        <button class="btn-ghost" onclick="showPrompt(3)">Show prompt</button>
                        <button class="btn-primary" id="run-btn-3" type="button">Try with AI</button>
                      </div>
                      <span>Goal: understand the model’s boundaries (and what assumptions you’re making).</span>
                    </div>
                  </div>

                  <div class="locked-panel" id="step-locked-3" style="display:none;">
                    <div class="locked-title">Locked</div>
                    <div class="locked-desc">This step is not available for your account level.</div>
                    <div class="locked-actions">
                      <a class="btn-primary" href="/pricing.html">View plans</a>
                      <a class="btn-pill" href="/auth.html" onclick="PS_setPostAuthRedirect && PS_setPostAuthRedirect()">Sign In</a>
                    </div>
                  </div>
                </div>
              </article>

              <!-- STEP 4 -->
              <article class="step-card" data-step="4">
                <div class="step-header">
                  <div class="step-header-left">
                    <div class="step-index">STEP 4</div>
                    <div class="step-title">Check your understanding: mini-quiz (answers hidden until you reveal)</div>
                  </div>
                  <div class="step-header-right">
                    <span class="step-access-pill mastery">Paid</span>
                    <button class="toggle-btn" id="toggle-btn-4" onclick="toggleStep(4)">−</button>
                  </div>
                </div>

                <div class="step-content" id="step-content-4">
                  <div class="step-unlocked" id="step-unlocked-4">
                    <div class="step-body">
                      Try each question first. Answers + feedback appear only when you click <strong>Reveal answer</strong>.
                      This prevents accidental spoilers and builds real exam readiness.
                    </div>

                    <div class="prompt-preview" id="preview-step4">Prompt preview will appear here.</div>
                    <div class="ai-response" id="response-step4"></div>

                    <div class="copy-row">
                      <button class="btn-ghost btn-copy" onclick="copyPrompt(4)">Copy prompt</button>
                      <button class="btn-ghost btn-copy" id="copy-answer-4" onclick="copyAnswer(4)" style="display:none;">Copy answer</button>
                    </div>

                    <div class="step-footer">
                      <div class="left-actions">
                        <button class="btn-ghost" onclick="showPrompt(4)">Show prompt</button>
                        <button class="btn-primary" id="run-btn-4" type="button">Run with AI</button>
                      </div>
                      <span>Goal: attempt first → then reveal and learn from your mistakes.</span>
                    </div>
                  </div>

                  <div class="locked-panel" id="step-locked-4" style="display:none;">
                    <div class="locked-title">Paid step</div>
                    <div class="locked-desc">Steps 4–6 are part of paid access.</div>
                    <div class="locked-actions">
                      <a class="btn-primary" href="/pricing.html">Unlock full access</a>
                      <a class="btn-pill" href="/auth.html" onclick="PS_setPostAuthRedirect && PS_setPostAuthRedirect()">Sign In</a>
                    </div>
                  </div>
                </div>
              </article>

              <!-- STEP 5 -->
              <article class="step-card" data-step="5">
                <div class="step-header">
                  <div class="step-header-left">
                    <div class="step-index">STEP 5</div>
                    <div class="step-title">Practice: solve 1D constant-a problems step-by-step</div>
                  </div>
                  <div class="step-header-right">
                    <span class="step-access-pill mastery">Paid</span>
                    <button class="toggle-btn" id="toggle-btn-5" onclick="toggleStep(5)">−</button>
                  </div>
                </div>

                <div class="step-content" id="step-content-5">
                  <div class="step-unlocked" id="step-unlocked-5">
                    <div class="step-body">
                      Work through carefully chosen problems (speeding up, braking, free-fall, thrown upward),
                      with sign conventions and equation choices explained.
                    </div>

                    <div class="prompt-preview" id="preview-step5">Prompt preview will appear here.</div>
                    <div class="ai-response" id="response-step5"></div>

                    <div class="copy-row">
                      <button class="btn-ghost btn-copy" onclick="copyPrompt(5)">Copy prompt</button>
                      <button class="btn-ghost btn-copy" id="copy-answer-5" onclick="copyAnswer(5)" style="display:none;">Copy answer</button>
                    </div>

                    <div class="step-footer">
                      <div class="left-actions">
                        <button class="btn-ghost" onclick="showPrompt(5)">Show prompt</button>
                        <button class="btn-primary" id="run-btn-5" type="button">Run with AI</button>
                      </div>
                      <span>Goal: reliably translate words → diagram → equations → answer.</span>
                    </div>
                  </div>

                  <div class="locked-panel" id="step-locked-5" style="display:none;">
                    <div class="locked-title">Paid step</div>
                    <div class="locked-desc">Steps 4–6 are part of paid access.</div>
                    <div class="locked-actions">
                      <a class="btn-primary" href="/pricing.html">Unlock full access</a>
                      <a class="btn-pill" href="/auth.html" onclick="PS_setPostAuthRedirect && PS_setPostAuthRedirect()">Sign In</a>
                    </div>
                  </div>
                </div>
              </article>

              <!-- STEP 6 -->
              <article class="step-card" data-step="6">
                <div class="step-header">
                  <div class="step-header-left">
                    <div class="step-index">STEP 6</div>
                    <div class="step-title">Summary & reflection + Exploration / “simulation” prompts</div>
                  </div>
                  <div class="step-header-right">
                    <span class="step-access-pill mastery">Paid</span>
                    <button class="toggle-btn" id="toggle-btn-6" onclick="toggleStep(6)">−</button>
                  </div>
                </div>

                <div class="step-content" id="step-content-6">
                  <div class="step-unlocked" id="step-unlocked-6">
                    <div class="step-body">
                      Consolidate the key takeaways, then explore “what if?” scenarios by changing parameters
                      (u, a, t), predicting graph changes, and checking consistency.
                    </div>

                    <div class="prompt-preview" id="preview-step6">Prompt preview will appear here.</div>
                    <div class="ai-response" id="response-step6"></div>

                    <div class="copy-row">
                      <button class="btn-ghost btn-copy" onclick="copyPrompt(6)">Copy prompt</button>
                      <button class="btn-ghost btn-copy" id="copy-answer-6" onclick="copyAnswer(6)" style="display:none;">Copy answer</button>
                    </div>

                    <div class="step-footer">
                      <div class="left-actions">
                        <button class="btn-ghost" onclick="showPrompt(6)">Show prompt</button>
                        <button class="btn-primary" id="run-btn-6" type="button">Run with AI</button>
                      </div>
                      <span>Goal: summarize + push your intuition using parameter tweaks and graph reasoning.</span>
                    </div>
                  </div>

                  <div class="locked-panel" id="step-locked-6" style="display:none;">
                    <div class="locked-title">Paid step</div>
                    <div class="locked-desc">Steps 4–6 are part of paid access.</div>
                    <div class="locked-actions">
                      <a class="btn-primary" href="/pricing.html">Unlock full access</a>
                      <a class="btn-pill" href="/auth.html" onclick="PS_setPostAuthRedirect && PS_setPostAuthRedirect()">Sign In</a>
                    </div>
                  </div>
                </div>
              </article>

            </div>
          </div>

          <!-- RIGHT: Help Panel -->
          <aside class="help-panel">
            <div class="help-panel-inner" id="help-panel-inner">

              <button class="help-panel-toggle" id="help-panel-toggle" type="button">
                <span class="nano-help-title">Deepen your understanding</span>
                <span class="help-panel-toggle-icon">▾</span>
              </button>

              <!-- Wrap body + overlay so we can HARD LOCK interactions when not paid -->
              <div class="help-lock-wrap" id="help-lock-wrap">

                <div class="help-panel-body" id="help-panel-body">
                  <p>
                    Use these help topics when you feel stuck, when graphs feel confusing, or when answers
                    don’t match your intuition.
                  </p>

                  <div class="help-cta" id="help-cta" aria-hidden="true">
                    <div class="kicker">Mastery feature</div>
                    <div class="title">Help Library + guided prompt paths</div>
                    <div class="desc">
                      Upgrade to Mastery to unlock the Help Library for this lesson.
                    </div>
                    <div class="actions">
                      <a class="btn-primary" href="/pricing.html">Upgrade to Mastery</a>
                      <a class="btn-pill" href="/auth.html" onclick="PS_setPostAuthRedirect && PS_setPostAuthRedirect()">Sign In</a>
                    </div>
                  </div>

                  <div class="help-category">
                    <div>
                      <span class="help-category-label">Confusions &amp; look-alikes</span>
                      <p class="help-category-desc">Separate velocity, acceleration, slope, and area ideas.</p>
                    </div>
                    <ul class="help-prompts-bulleted">
                      <li><a class="help-prompt-btn" href="help-constant-acceleration.html?id=CL01">Slope vs value: what the v–t graph is really telling you</a></li>
                      <li><a class="help-prompt-btn" href="help-constant-acceleration.html?id=CL02">Average vs instantaneous acceleration (and why constant-a makes them match)</a></li>
                    </ul>
                  </div>

                  <div class="help-category">
                    <div>
                      <span class="help-category-label">Tricky areas &amp; exam traps</span>
                      <p class="help-category-desc">Avoid the classic sign and “top of motion” traps.</p>
                    </div>
                    <ul class="help-prompts-bulleted">
                      <li><a class="help-prompt-btn" href="help-constant-acceleration.html?id=ET01">At the top of the throw: velocity is zero, acceleration is not</a></li>
                      <li><a class="help-prompt-btn" href="help-constant-acceleration.html?id=ET02">Sign conventions: choosing + upward vs + downward without confusion</a></li>
                    </ul>
                  </div>

                  <div class="help-category">
                    <div>
                      <span class="help-category-label">Common mistakes</span>
                      <p class="help-category-desc">Fix the errors that cause most wrong answers.</p>
                    </div>
                    <ul class="help-prompts-bulleted">
                      <li><a class="help-prompt-btn" href="help-constant-acceleration.html?id=CM01">Mixing up “acceleration is constant” with “velocity is constant”</a></li>
                      <li><a class="help-prompt-btn" href="help-constant-acceleration.html?id=CM02">Using the wrong kinematics equation for the knowns you have</a></li>
                    </ul>
                  </div>

                  <div class="help-category">
                    <div>
                      <span class="help-category-label">When you feel stuck</span>
                      <p class="help-category-desc">Get unstuck with a reliable problem-solving routine.</p>
                    </div>
                    <ul class="help-prompts-bulleted">
                      <li><a class="help-prompt-btn" href="help-constant-acceleration.html?id=ST01">How to draw a quick motion diagram and decide signs</a></li>
                      <li><a class="help-prompt-btn" href="help-constant-acceleration.html?id=ST02">Given 3 variables, how to pick the right equation in 10 seconds</a></li>
                    </ul>
                  </div>

                  <div class="help-category">
                    <div>
                      <span class="help-category-label">Concept bridges</span>
                      <p class="help-category-desc">Connect constant-a kinematics to dynamics and calculus.</p>
                    </div>
                    <ul class="help-prompts-bulleted">
                      <li><a class="help-prompt-btn" href="help-constant-acceleration.html?id=BR01">How constant-a leads into Newton’s laws (forces cause acceleration)</a></li>
                      <li><a class="help-prompt-btn" href="help-constant-acceleration.html?id=BR02">How derivatives/integrals connect to v = dx/dt and a = dv/dt</a></li>
                    </ul>
                  </div>

                </div>

                <!-- HARD LOCK OVERLAY (shown for anon + free) -->
                <div class="help-lock-overlay" id="help-lock-overlay" aria-hidden="true">
                  <div class="teaser-card">
                    <div class="teaser-kicker">Mastery feature</div>
                    <div class="teaser-title">Unlock the Help Library</div>
                    <div class="teaser-desc">
                      The Help panel (topics + prompts) is part of Mastery. Upgrade to access these help paths and prompts.
                    </div>
                    <div class="teaser-actions">
                      <a class="btn-primary" href="/pricing.html">Upgrade to Mastery</a>
                      <a class="btn-pill" href="/auth.html" onclick="PS_setPostAuthRedirect && PS_setPostAuthRedirect()">Sign In</a>
                    </div>
                  </div>
                </div>

              </div>

            </div>
          </aside>

        </div>
      </div>
    </section>
  </main>

  <footer>
  <a href="/about.html">About</a>
    © 2025 PromptSchola. All rights reserved.
  </footer>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="/auth.js"></script>

<script>
/* ============================================================
   Refactor: shorter JS, SAME behavior + gating (locked design)
   ============================================================ */

/* Continue Learning marker */
(function PS_markLastLearningPage(){
  try{
    const p = location.pathname || '';
    if (p === '/' || p.endsWith('/index.html') || p.endsWith('/auth.html') || p.endsWith('/pricing.html')) return;
    const t = (document.title || '').replace(/\s+–\s+PromptSchola.*$/i,'').trim();
    localStorage.setItem('ps_last_page_path', p);
    localStorage.setItem('ps_last_page_label', t || 'Continue Learning');
    localStorage.setItem('ps_last_seen_ts', String(Date.now()));
  } catch(e){}
})();

/* Post-auth redirect helper (used by nav + locked CTAs) */
function PS_setPostAuthRedirect(){
  try{
    localStorage.setItem('ps_post_auth_redirect', location.pathname + location.search + location.hash);
  } catch(e){}
}
window.PS_setPostAuthRedirect = PS_setPostAuthRedirect;

/* Prompts (unchanged content) */
const prompts = {
  1: `You are a friendly, rigorous Physics tutor for final-year high school and first-year university students.\n\nTopic: Constant acceleration in 1D.\n\nSTEP 1 (Orient/Definition): Explain clearly what “constant acceleration” means. Include:\n• A one-sentence definition\n• What it implies about how velocity changes with time\n• A quick note about choosing a positive direction and using sign conventions\n• 2 everyday examples (car speeding up steadily, free-fall near Earth)\n\nFormatting rules:\n• Short paragraphs + bullet points\n• Bold key terms sparingly\n• If you include equations, use LaTeX display math, one per line:\n  \\\\[ a = \\frac{\\Delta v}{\\Delta t} \\\\]\n  \\\\[ v = u + at \\\\]\n• Do NOT use markdown headings like # or ###.`,
  2: `You are a friendly, rigorous Physics tutor for final-year high school and first-year university students.\n\nTopic: Constant acceleration in 1D.\n\nSTEP 2 (Conceptual grounding): Build intuition using:\n• A car accelerating at a steady rate\n• A ball dropped from rest (free-fall)\n• A ball thrown upward then coming down (address the myth “acceleration is zero at the top”)\n\nFor each, describe what the v–t, a–t, and x–t graphs should look like (qualitatively). Emphasize:\n• Slope of v–t is acceleration\n• Area under a–t gives change in velocity\n• Area under v–t gives displacement\n\nInclude ONE worked anchor example with numbers (brief): choose simple values and show how you’d read slope/area to get a result.\n\nFormatting rules:\n• Short paragraphs + bullets\n• Bold key concepts sparingly\n• If you include equations, use LaTeX display math one per line\n• Do NOT use markdown headings like # or ###.`,
  3: `You are a friendly, rigorous Physics tutor for final-year high school and first-year university students.\n\nTopic: Constant acceleration in 1D.\n\nSTEP 3 (Real-world connection): Explain when constant acceleration is a good approximation and when it breaks.\nInclude:\n• Free-fall near Earth (when air resistance is negligible)\n• A car braking (roughly constant a over a short interval)\n• Why air resistance makes acceleration change\n• The difference between average acceleration and instantaneous acceleration, and why constant-a makes them match\n\nAdd 3 “modeling questions” students should ask before using constant-a equations.\n\nFormatting rules:\n• Short paragraphs + bullets\n• Bold key terms sparingly\n• If you include equations, use LaTeX display math one per line\n• Do NOT use markdown headings like # or ###.`,
  4: `You are a friendly, rigorous Physics tutor for final-year high school and first-year university students.\n\nTopic: Constant acceleration in 1D.\n\nSTEP 4 (Check your understanding – mini-quiz): Create 7 questions total:\n• 4 multiple-choice (A–D)\n• 2 short-answer\n• 1 graph reasoning question (describe the graph in words; no images)\n\nCoverage must include:\n• Sign conventions\n• “Top of motion” concept (v=0 but a≠0)\n• Interpreting slope/area on v–t / a–t\n• Choosing the right kinematics equation based on knowns\n\nCRITICAL OUTPUT FORMAT (so the site can hide answers):\nFor each question, write the question first, then put the answer+explanation inside these exact markers on their own lines:\n[[[ANSWER]]]\n...answer + 1–2 sentence explanation...\n[[[/ANSWER]]]\n\nExample structure:\n1) ...question text...\n[[[ANSWER]]]\nCorrect answer: B\nExplanation: ...\n[[[/ANSWER]]]\n\nFormatting rules:\n• Clear spacing\n• Bullets and numbering\n• No markdown headings like # or ###.`,
  5: `You are a friendly, rigorous Physics tutor for final-year high school and first-year university students.\n\nTopic: Constant acceleration in 1D.\n\nSTEP 5 (Practice): Create 4 problems with increasing difficulty:\n1) Start from rest, constant a, find v and displacement after t\n2) Non-zero initial velocity, constant a, find time to reach a velocity\n3) Free-fall (choose + upward OR + downward, but be consistent), include sign convention explicitly\n4) Mixed: find displacement using v^2 = u^2 + 2as (or equivalent) with careful reasoning\n\nFor each problem:\n• State the problem clearly\n• Then provide a step-by-step solution with brief reasoning\n• Show equations as LaTeX display math, one per line\n\nFormatting rules:\n• Numbered problems\n• Bold “Solution” for each\n• No markdown headings like # or ###.`,
  6: `You are a friendly, rigorous Physics tutor for final-year high school and first-year university students.\n\nTopic: Constant acceleration in 1D.\n\nSTEP 6 (Summary & reflection + Exploration/Simulation prompts):\nPART A — Summary & reflection:\n• Give a tight summary of the core ideas (definition, graphs, sign conventions)\n• Provide a “reflection checklist” with 6 yes/no items students can self-check\n\nPART B — Exploration:\nProvide 5 “what if” experiments students can do on paper:\n• Change u, a, or t and predict how v–t and x–t graphs change\n• Include at least 1 scenario where acceleration changes (air resistance) and ask them to compare to the constant-a model\n\nFormatting rules:\n• Short paragraphs + bullet lists\n• Bold key terms sparingly\n• If you include equations, use LaTeX display math one per line\n• Do NOT use markdown headings like # or ###.`
};

const STORAGE_KEY = 'ps_nano_constant_acceleration_collapse';
const lastAiResponses = {};
let collapseState = {};

const $ = (id) => document.getElementById(id);
const typeset = (nodes) => window.MathJax?.typesetPromise ? MathJax.typesetPromise(nodes ? [].concat(nodes) : undefined).catch(()=>{}) : null;

function loadCollapse(){
  try { collapseState = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}') || {}; }
  catch { collapseState = {}; }
}
function saveCollapse(){
  try { localStorage.setItem(STORAGE_KEY, JSON.stringify(collapseState)); } catch(e){}
}

/* ===== Output formatting (keeps same rules; shorter) ===== */
function esc(s){
  return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
    .replace(/\\\\\[/g,'\\[').replace(/\\\\\]/g,'\\]').replace(/\\\\\(/g,'\\(').replace(/\\\\\)/g,'\\)');
}
function inlineFmt(s){
  // remove headings, normalize bullets, bold/italic
  return s
    .replace(/^#{1,6}\s+(.+)$/gm,'<strong>$1</strong>')
    .replace(/^\s*[-*]\s+/gm,'• ')
    .replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>')
    // lighter italic rule (keeps your prior behavior)
    .replace(/\*(.+?)\*/g,'<em>$1</em>');
}
function paras(s){
  s = s.replace(/\n\n+/g,'</p><p>').replace(/\n/g,'<br>');
  return '<p>' + s + '</p>';
}
function formatOutput(raw){
  return paras(inlineFmt(esc(raw)));
}
function formatQuizWithToggles(raw){
  const safe = esc(raw);
  const OPEN='[[[ANSWER]]]', CLOSE='[[[/ANSWER]]]';
  let out = '', i = 0;

  while(true){
    const a = safe.indexOf(OPEN, i);
    if (a === -1){ out += safe.slice(i); break; }
    const b = safe.indexOf(CLOSE, a + OPEN.length);
    if (b === -1){ out += safe.slice(i); break; }

    out += safe.slice(i, a);
    const inner = safe.slice(a + OPEN.length, b).trim();
    out += `\n\n<details class="answer-toggle"><summary>Reveal answer</summary><div class="answer-body">${paras(inlineFmt(inner))}</div></details>\n\n`;
    i = b + CLOSE.length;
  }

  // format non-details chunks, keep details blocks intact
  return out.split(/(<details class="answer-toggle">[\s\S]*?<\/details>)/g)
    .map(part => part.startsWith('<details class="answer-toggle">') ? part : formatOutput(part))
    .join('');
}

/* ===== Step collapse toggle (keeps your stored convention) ===== */
function toggleStep(step){
  const content = $(`step-content-${step}`);
  const btn = $(`toggle-btn-${step}`);
  if (!content || !btn) return;

  const hidden = content.style.display === 'none';
  content.style.display = hidden ? 'block' : 'none';
  btn.textContent = hidden ? '−' : '+';

  // store true when open, false when collapsed (your existing convention)
  collapseState[step] = hidden;
  saveCollapse();
}

/* ===== Prompt show/copy ===== */
function showPrompt(step){
  const preview = $(`preview-step${step}`);
  if (!preview) return;
  preview.textContent = prompts[step] || 'Prompt coming soon.';
  preview.style.display = 'block';
  typeset([preview]);
}
async function copyText(t, okMsg, failMsg){
  if (!t) return alert(failMsg || 'Nothing to copy.');
  if (!navigator.clipboard?.writeText) return alert('Clipboard not supported in this browser.');
  try { await navigator.clipboard.writeText(t); alert(okMsg || 'Copied.'); }
  catch { alert(failMsg || 'Could not copy.'); }
}
function copyPrompt(step){ return copyText(prompts[step], 'Prompt copied.', 'No prompt defined for this step yet.'); }
function copyAnswer(step){ return copyText(lastAiResponses[step], 'Answer copied.', 'No AI answer to copy yet.'); }

/* ===== Run-with-AI gating + API call ===== */
function redirectToSignupForRunAI(){
  const redirectTarget = encodeURIComponent(location.href);
  location.href = `/auth.html?mode=signup&reason=run-ai&redirect=${redirectTarget}`;
}
function setRunBtnRunning(step, running){
  const btn = $(`run-btn-${step}`);
  if (!btn) return;
  if (running){
    btn.dataset.prevText = btn.textContent;
    btn.textContent = 'Running…';
    btn.disabled = true;
    btn.setAttribute('aria-busy', 'true');
  } else {
    btn.disabled = false;
    btn.textContent = btn.dataset.prevText || btn.textContent;
    btn.removeAttribute('aria-busy');
  }
}
async function runWithAI(step){
  const prompt = prompts[step];
  if (!prompt) return alert('No prompt defined for this step yet.');

  const output = $(`response-step${step}`);
  if (!output) return alert('No response area found for this step.');

  const preview = $(`preview-step${step}`);
  if (preview) preview.style.display = 'none';

  // Require login for Run-with-AI (server enforces too)
  if (typeof ensureLoggedInOrRedirect === 'function'){
    const user = await ensureLoggedInOrRedirect();
    if (!user) return;
  } else {
    redirectToSignupForRunAI();
    return;
  }

  const token = (typeof PS_getAccessToken === 'function') ? await PS_getAccessToken() : null;
  if (!token){
    output.textContent = 'Session missing. Please sign in again.';
    return;
  }

  setRunBtnRunning(step, true);
  try{
    output.textContent = 'Running with AI…';

    const res = await fetch('/api/run-step', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
      body: JSON.stringify({ prompt, step })
    });

    const data = await res.json().catch(()=> ({}));
    if (!res.ok){
      let msg = data?.error || 'There was an error contacting the AI. Please try again later.';
      if (data?.code === 'PAYWALL') msg = 'This “Run with AI” requires Mastery (paid) access.';
      if (data?.code === 'INVALID_SESSION') msg = 'Session expired. Please sign in again.';
      if (data?.code === 'AUTH_REQUIRED') msg = 'Please sign in to use Run with AI.';
      if (data?.code === 'PROMPT_INVALID') msg = 'Prompt failed validation.\n\nDetails: ' + JSON.stringify(data?.details || []);
      output.textContent = msg;
      return;
    }

    const raw = data.content || 'No response received from AI.';
    lastAiResponses[step] = raw;
    output.innerHTML = (step === 4) ? formatQuizWithToggles(raw) : formatOutput(raw);
    typeset([output]);

    const copyBtn = $(`copy-answer-${step}`);
    if (copyBtn) copyBtn.style.display = 'inline-flex';
  } catch(err){
    console.error(err);
    output.textContent = 'Unexpected error. Please try again.';
  } finally {
    setRunBtnRunning(step, false);
  }
}

/* ===== Help hard lock (anon + free) ===== */
function configureHelpAccess(isPaid){
  const toggleBtn = $('help-panel-toggle');
  const body = $('help-panel-body');
  const overlay = $('help-lock-overlay');
  const wrap = $('help-lock-wrap');
  const icon = document.querySelector('.help-panel-toggle-icon');
  if (!toggleBtn || !body || !overlay || !wrap) return;

  if (isPaid){
    wrap.classList.remove('help-lock-disabled');
    overlay.style.display = 'none';
    overlay.setAttribute('aria-hidden','true');

    toggleBtn.disabled = false;
    toggleBtn.classList.remove('help-toggle-disabled');
    toggleBtn.setAttribute('aria-disabled','false');
    if (icon) icon.textContent = '▾';
  } else {
    wrap.classList.add('help-lock-disabled');      // blocks navigation + copy + clicks
    overlay.style.display = 'flex';
    overlay.setAttribute('aria-hidden','false');

    toggleBtn.disabled = true;                    // cannot toggle panel
    toggleBtn.classList.add('help-toggle-disabled');
    toggleBtn.setAttribute('aria-disabled','true');
    if (icon) icon.textContent = '🔒';

    body.style.display = 'block';                 // visible behind teaser (locked)
  }
}

/* ===== UI gating rules (locked design) ===== */
function configureUI({ loggedIn, tier }){
  const isPaid = tier === 'paid';
  const isFreeSignedIn = loggedIn && !isPaid;

  // Lock steps 4–6 content unless paid
  for (let step=1; step<=6; step++){
    const unlocked = $(`step-unlocked-${step}`);
    const locked = $(`step-locked-${step}`);
    if (!unlocked || !locked) continue;
    const lock = (step >= 4) && !isPaid;
    unlocked.style.display = lock ? 'none' : 'block';
    locked.style.display = lock ? 'block' : 'none';
  }

  // Help panel gating (HARD lock for anon + free)
  configureHelpAccess(isPaid);

  // Steps 1–2: anon redirects, free runs, paid runs
  [1,2].forEach(step => {
    const btn = $(`run-btn-${step}`);
    if (!btn) return;
    btn.style.display = 'inline-flex';
    btn.textContent = 'Run with AI';
    btn.onclick = () => (!loggedIn ? redirectToSignupForRunAI() : runWithAI(step));
  });

  // Step 3: anon redirects, free -> pricing, paid runs
  {
    const btn = $('run-btn-3');
    if (btn){
      btn.style.display = 'inline-flex';
      btn.textContent = 'Try with AI';
      btn.onclick = () => {
        if (!loggedIn) return redirectToSignupForRunAI();
        if (isFreeSignedIn) return (location.href = '/pricing.html');
        return runWithAI(3);
      };
    }
  }

  // Steps 4–6: run button hidden unless paid (and step content locked anyway)
  for (let step=4; step<=6; step++){
    const btn = $(`run-btn-${step}`);
    if (!btn) continue;
    if (isPaid){
      btn.style.display = 'inline-flex';
      btn.textContent = 'Run with AI';
      btn.onclick = () => runWithAI(step);
    } else {
      btn.style.display = 'none';
    }
  }
}

/* ===== Boot ===== */
document.addEventListener('DOMContentLoaded', async () => {
  loadCollapse();
  for (let step=1; step<=6; step++){
    const content = $(`step-content-${step}`);
    const btn = $(`toggle-btn-${step}`);
    if (!content || !btn) continue;
    const isCollapsed = collapseState[step] === false; // stored false => collapsed
    content.style.display = isCollapsed ? 'none' : 'block';
    btn.textContent = isCollapsed ? '+' : '−';
  }

  typeset();

  // Nav display (auth.js)
  if (typeof updateNavUserDisplay === 'function') updateNavUserDisplay();

  // Determine logged-in + tier
  let loggedIn = false, tier = 'anon';
  if (typeof getCurrentUser === 'function'){
    try { loggedIn = !!(await getCurrentUser()); } catch(e){ loggedIn = false; }
  }
  if (loggedIn && typeof PS_getUserTier === 'function'){
    try { tier = (await PS_getUserTier()) || 'free'; } catch(e){ tier = 'free'; }
  }
  if (loggedIn && tier === 'anon') tier = 'free';

  configureUI({ loggedIn, tier });
});
</script>

</body>
</html>

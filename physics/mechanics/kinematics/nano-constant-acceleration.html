<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Help Library: Constant Acceleration – PromptSchola Physics</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta
    name="description"
    content="Help Library for Constant Acceleration: confusions, exam traps, common mistakes, getting unstuck, and concept bridges. Browse for free; run guided AI help with Mastery."
  />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Lora:ital,wght@0,600;0,700;1,500&display=swap" rel="stylesheet">

  <script>
    window.MathJax = {
      tex: { inlineMath: [['\\(','\\)'], ['$', '$']], displayMath: [['\\[','\\]'], ['$$','$$']] },
      svg: { fontCache: 'global' }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"></script>

  <style>
    :root{
      --bg-body:#f3f4f6;
      --bg-surface:#f9fafb;
      --bg-card:#ffffff;

      /* ROYAL BLUE HELP THEME (implemented) */
      --help-accent:#2563eb;        /* royal blue */
      --help-accent-strong:#1d4ed8; /* deeper */
      --help-accent-soft:rgba(37, 99, 235, 0.10);
      --help-accent-soft2:rgba(59, 130, 246, 0.14);

      /* keep PromptSchola purple elsewhere (nav/buttons can remain purple) */
      --accent:#7e22ce;
      --accent-strong:#6d28d9;

      --text-main:#111827;
      --text-muted:#4b5563;
      --text-subtle:#9ca3af;
      --text-strong:#020617;

      --border-subtle:rgba(209,213,219,0.55);
      --radius-card:18px;
      --radius-pill:999px;
      --shadow-soft:0 18px 40px rgba(15,23,42,0.12);
      --shadow-card:0 16px 35px rgba(15,23,42,0.12);

      --font-heading:'Lora', serif;
      --font-body:'Inter', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;

      --transition-fast:0.25s ease-out;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    a{text-decoration:none;color:inherit}

    body{
      font-family:var(--font-body);
      background:
        radial-gradient(circle at top, #e5e7eb, #f9fafb 45%, #f3f4f6);
      color:var(--text-main);
      line-height:1.7;
      -webkit-font-smoothing:antialiased;
      font-size:16.5px;
      letter-spacing:-0.01em;
      overflow-x:hidden;
    }

    h1,h2,h3{
      font-family:var(--font-heading);
      color:var(--text-strong);
      line-height:1.15;
    }

    .page{min-height:100vh;display:flex;flex-direction:column}
    .container{width:100%;max-width:1120px;margin:0 auto;padding:0 1.4rem}

    header{
      position:sticky;top:0;z-index:40;
      backdrop-filter:blur(14px);
      background:linear-gradient(to bottom, rgba(249,250,251,0.96), rgba(249,250,251,0.94), rgba(249,250,251,0.9));
      border-bottom:1px solid rgba(209,213,219,0.9);
    }

    .nav{display:flex;align-items:center;justify-content:space-between;padding:0.75rem 0;gap:1rem}
    .nav-left{display:flex;align-items:center;gap:0.75rem}
    .logo-mark{
      width:34px;height:34px;border-radius:40%;
      background:radial-gradient(circle at 30% 30%, var(--accent), var(--accent-strong));
      display:flex;align-items:center;justify-content:center;
      font-weight:800;font-size:1rem;color:#f9fafb;
      font-family:var(--font-body);
    }
    .logo-text span:first-child{
      display:block;font-weight:700;font-size:1.02rem;
      letter-spacing:0.02em;color:var(--text-strong);
      font-family:var(--font-body);line-height:1.1;
    }
    .logo-text span:last-child{
      display:block;font-size:0.76rem;color:var(--text-subtle);
      font-family:var(--font-body);
    }
    .nav-links{display:flex;align-items:center;gap:1.3rem;font-size:0.95rem}
    .nav-links a{color:var(--text-muted);opacity:0.9;transition:opacity var(--transition-fast),color var(--transition-fast)}
    .nav-links a:hover{opacity:1;color:var(--accent-strong)}
    .nav-right{display:flex;align-items:center;gap:0.6rem;font-size:0.9rem;flex-wrap:wrap;justify-content:flex-end}

    .btn-pill{
      border-radius:var(--radius-pill);
      padding:0.45rem 0.95rem;
      font-size:0.86rem;
      border:1px solid rgba(209,213,219,0.9);
      background:#ffffff;
      color:var(--text-main);
      cursor:pointer;
      transition:background var(--transition-fast),transform var(--transition-fast),box-shadow var(--transition-fast),border-color var(--transition-fast);
      display:inline-flex;align-items:center;justify-content:center;white-space:nowrap;
      font-family:var(--font-body);
    }
    .btn-pill:hover{
      background:#f3f4f6;transform:translateY(-1px);
      border-color:rgba(156,163,175,0.9);
      box-shadow:0 8px 20px rgba(148,163,184,0.35);
    }

    /* Purple primary stays consistent with site */
    .btn-primary{
      border-radius:var(--radius-pill);
      padding:0.6rem 1.3rem;
      font-size:0.9rem;font-weight:600;border:none;cursor:pointer;
      background:radial-gradient(circle at 30% 0%, #a855f7, #7e22ce, #4c1d95);
      color:#f9fafb;
      transition:transform var(--transition-fast),filter var(--transition-fast),background var(--transition-fast);
      display:inline-flex;align-items:center;justify-content:center;gap:0.35rem;white-space:nowrap;
      font-family:var(--font-body);
    }
    .btn-primary:hover{
      transform:translateY(-1px);filter:brightness(1.03);
      background:radial-gradient(circle at 30% 0%, #c084fc, #7e22ce, #4c1d95);
    }

    /* ROYAL BLUE action for Help pages */
    .btn-help{
      border-radius:var(--radius-pill);
      padding:0.6rem 1.05rem;
      font-size:0.88rem;
      font-weight:700;
      border:1px solid rgba(37,99,235,0.35);
      cursor:pointer;
      background:radial-gradient(circle at 20% 0%, #60a5fa, var(--help-accent), var(--help-accent-strong));
      color:#f8fafc;
      transition:transform var(--transition-fast),filter var(--transition-fast);
      display:inline-flex;align-items:center;justify-content:center;gap:0.35rem;white-space:nowrap;
      font-family:var(--font-body);
    }
    .btn-help:hover{transform:translateY(-1px);filter:brightness(1.03)}
    .btn-help[disabled]{opacity:0.55;cursor:not-allowed;transform:none!important;filter:none!important}

    .hero{
      padding:3.6rem 0 2.0rem;
      position:relative;
      overflow:hidden;
    }
    .hero::before{
      content:"";
      position:absolute;
      inset:-90px;
      pointer-events:none;
      background:
        radial-gradient(circle at 12% 0%, rgba(59,130,246,0.42), transparent 60%),
        radial-gradient(circle at 92% 35%, rgba(37,99,235,0.30), transparent 55%),
        radial-gradient(circle at 55% 80%, rgba(126,34,206,0.10), transparent 58%);
      opacity:0.95;
      z-index:-1;
    }

    .hero-kicker{
      display:inline-flex;align-items:center;gap:0.55rem;
      font-size:0.78rem;text-transform:uppercase;letter-spacing:0.15em;
      color:var(--help-accent-strong);
      font-weight:800;margin-bottom:0.95rem;
    }
    .hero-kicker .label{
      padding:0.18rem 0.7rem;
      border-radius:8px;
      border:1px solid rgba(37,99,235,0.24);
      background:var(--help-accent-soft2);
      color:var(--help-accent-strong);
      font-weight:900;
      letter-spacing:0.14em;
    }
    .hero-title{
      font-size:clamp(2.0rem, 3.5vw, 2.6rem);
      line-height:1.12;
      font-weight:700;
      margin:0 0 0.7rem;
      color:var(--text-strong);
      max-width:56rem;
    }
    .hero-subtitle{
      font-size:1.05rem;
      max-width:56rem;
      color:var(--text-muted);
      line-height:1.6;
    }
    .hero-breadcrumbs{
      margin-top:0.9rem;
      font-size:0.86rem;
      color:var(--text-subtle);
    }
    .hero-breadcrumbs a{color:var(--help-accent-strong)}

    main{padding-bottom:2.6rem}
    section{padding:1.35rem 0}

    .layout{
      display:grid;
      grid-template-columns: minmax(260px, 0.95fr) minmax(0, 2.35fr);
      gap:1.3rem;
      align-items:start;
    }

    .side{
      position:sticky; top:6rem;
      align-self:start;
    }

    .side-card{
      background:var(--bg-card);
      border-radius:var(--radius-card);
      border:1px solid var(--border-subtle);
      box-shadow:var(--shadow-card);
      padding:0.95rem 0.95rem 0.85rem;
    }

    .side-title{
      display:flex;align-items:center;justify-content:space-between;gap:0.6rem;
      margin-bottom:0.6rem;
    }
    .side-title h3{
      font-size:1.05rem;
      font-weight:700;
      color:var(--text-strong);
    }

    .pill{
      display:inline-flex;align-items:center;gap:0.4rem;
      font-size:0.72rem;font-weight:900;text-transform:uppercase;letter-spacing:0.09em;
      padding:0.18rem 0.55rem;border-radius:999px;
      border:1px solid rgba(37,99,235,0.22);
      background:var(--help-accent-soft2);
      color:var(--help-accent-strong);
      white-space:nowrap;
    }

    .side-desc{
      color:var(--text-muted);
      font-size:0.9rem;
      line-height:1.6;
      margin-bottom:0.65rem;
    }

    .topic-list{
      list-style:none;
      display:flex;flex-direction:column;
      gap:0.35rem;
      margin-top:0.3rem;
    }

    .topic-link{
      display:flex;align-items:center;justify-content:space-between;gap:0.7rem;
      padding:0.55rem 0.6rem;
      border-radius:14px;
      border:1px solid rgba(209,213,219,0.75);
      background:linear-gradient(to bottom, rgba(249,250,251,0.95), rgba(249,250,251,0.86));
      transition:transform var(--transition-fast), border-color var(--transition-fast), box-shadow var(--transition-fast);
      cursor:pointer;
    }
    .topic-link:hover{
      transform:translateY(-1px);
      border-color:rgba(37,99,235,0.35);
      box-shadow:0 10px 22px rgba(148,163,184,0.28);
    }

    .topic-left{
      display:flex;flex-direction:column;gap:0.1rem;min-width:0;
    }
    .topic-code{
      font-size:0.74rem;
      font-weight:900;
      letter-spacing:0.12em;
      color:var(--help-accent-strong);
      font-family:var(--font-body);
      opacity:0.95;
    }
    .topic-name{
      font-size:0.9rem;
      color:var(--text-strong);
      font-weight:700;
      line-height:1.25;
      font-family:var(--font-body);
      word-break:break-word;
    }

    .topic-badge{
      font-size:0.72rem;
      font-weight:900;
      padding:0.18rem 0.55rem;
      border-radius:999px;
      border:1px solid rgba(209,213,219,0.85);
      background:#ffffff;
      color:var(--text-muted);
      white-space:nowrap;
    }
    .topic-link.active{
      border-color:rgba(37,99,235,0.45);
      background:linear-gradient(to bottom, rgba(37,99,235,0.08), rgba(249,250,251,0.92));
    }
    .topic-link.active .topic-badge{
      border-color:rgba(37,99,235,0.28);
      background:var(--help-accent-soft2);
      color:var(--help-accent-strong);
    }

    .main-card{
      background:var(--bg-card);
      border-radius:var(--radius-card);
      border:1px solid var(--border-subtle);
      box-shadow:var(--shadow-card);
      padding:1.05rem 1.15rem 1.1rem;
      overflow:hidden;
    }

    .main-head{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:0.9rem;
      flex-wrap:wrap;
      margin-bottom:0.75rem;
    }

    .main-head .titles{min-width:0}
    .main-kicker{
      display:inline-flex;
      align-items:center;
      gap:0.45rem;
      font-size:0.78rem;
      font-weight:900;
      letter-spacing:0.13em;
      text-transform:uppercase;
      color:var(--help-accent-strong);
      margin-bottom:0.25rem;
    }
    .main-title{
      font-size:1.45rem;
      font-weight:700;
      color:var(--text-strong);
      line-height:1.18;
      margin-bottom:0.2rem;
    }
    .main-sub{
      color:var(--text-muted);
      font-size:0.95rem;
      line-height:1.65;
      max-width:52rem;
    }

    .access-strip{
      width:100%;
      border-radius:16px;
      border:1px solid rgba(37,99,235,0.25);
      background:linear-gradient(to bottom, rgba(37,99,235,0.08), rgba(37,99,235,0.05));
      padding:0.75rem 0.85rem;
      display:flex;
      gap:0.75rem;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
      margin-top:0.65rem;
    }
    .access-strip .text{
      color:var(--text-muted);
      font-size:0.9rem;
      line-height:1.55;
      max-width:44rem;
    }
    .access-strip strong{color:var(--text-strong)}

    .actions{
      display:flex;gap:0.5rem;flex-wrap:wrap;align-items:center;
    }

    .content{
      margin-top:0.95rem;
      color:var(--text-main);
      font-size:0.98rem;
      line-height:1.75;
    }

    .content .info-box{
      margin-top:0.75rem;
      border-radius:14px;
      border:1px solid rgba(37,99,235,0.22);
      background:var(--help-accent-soft);
      padding:0.8rem 0.85rem;
      color:var(--text-muted);
      font-size:0.92rem;
      line-height:1.6;
    }

    .ai-response{
      margin-top:0.85rem;
      padding:1.0rem 1.05rem;
      border-radius:14px;
      border:1px solid rgba(37,99,235,0.35);
      background:#ffffff;
      min-height:1.1rem;
      color:#111827;
      white-space:pre-wrap;
    }
    .ai-response p{margin-bottom:0.85rem}
    .ai-response ul,.ai-response ol{margin:0.7rem 0 0.7rem 1.3rem}
    .ai-response strong{font-weight:800}
    .ai-response em{font-style:italic}

    .locked-panel{
      margin-top:0.85rem;
      border-radius:16px;
      border:1px solid rgba(37,99,235,0.30);
      background:linear-gradient(to bottom, rgba(37,99,235,0.10), rgba(249,250,251,0.90));
      padding:0.95rem 1rem;
      color:#111827;
      display:none;
    }
    .locked-title{font-family:var(--font-heading);font-size:1.05rem;color:var(--text-strong);margin-bottom:0.25rem;font-weight:700}
    .locked-desc{color:var(--text-muted);font-size:0.92rem;line-height:1.65;margin-bottom:0.7rem}
    .locked-actions{display:flex;gap:0.5rem;flex-wrap:wrap}

    footer{
      margin-top:auto;
      padding:1.8rem 0 2.1rem;
      text-align:center;
      font-size:0.86rem;
      color:var(--text-subtle);
      font-family:var(--font-body);
    }

    @media (max-width: 980px){
      .layout{grid-template-columns:minmax(0,1fr)}
      .side{position:static}
    }
    @media (max-width: 860px){
      .nav-links{display:none}
    }
  </style>
</head>

<body>
<div class="page">

  <header>
    <div class="container">
      <div class="nav">
        <div class="nav-left">
          <div class="logo-mark">P</div>
          <div class="logo-text">
            <span>PromptSchola</span>
            <span>Prompt-based STEM subjects mastery</span>
          </div>
        </div>

        <nav class="nav-links">
          <a href="/index.html">Home</a>
          <a href="/physics/physics.html">Physics</a>
          <a href="/math/math.html">Math</a>
          <a href="/chemistry/chemistry.html">Chemistry</a>
          <a href="/biology/biology.html">Biology</a>
          <a href="/pricing.html">Pricing</a>
        </nav>

        <div class="nav-right">
          <span id="nav-user" style="font-size:0.78rem;color:#9ca3af;"></span>

          <a id="nav-login-btn" href="/auth.html" class="btn-pill" onclick="PS_setPostAuthRedirect && PS_setPostAuthRedirect()">
            Sign In
          </a>

          <a id="nav-register-btn" href="/auth.html?mode=signup" class="btn-primary" onclick="PS_setPostAuthRedirect && PS_setPostAuthRedirect()">
            Register for Free
          </a>

          <button
            id="nav-signout-btn"
            type="button"
            class="btn-pill"
            style="display:none;"
            onclick="signOutUser && signOutUser()"
          >
            Sign out
          </button>
        </div>
      </div>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="container">
        <div class="hero-kicker">
          <span class="label">Help</span>
          <span>Physics · Mechanics · Kinematics (1D)</span>
        </div>

        <h1 class="hero-title">Help Library: Constant Acceleration</h1>

        <p class="hero-subtitle">
          Browse targeted explanations and “unstuck” paths. This page uses a <strong>royal-blue Help theme</strong>.
          Running the AI guidance here is a <strong>Mastery</strong> feature.
        </p>

        <div class="hero-breadcrumbs">
          <a href="/physics/physics.html">Physics</a> ·
          <a href="/physics/mechanics.html">Mechanics</a> ·
          <a href="/physics/kinematics-in-one-dimension.html">Kinematics in 1D</a> ·
          <a href="/physics/constant-acceleration.html">Constant Acceleration</a> ·
          <span>Help</span>
        </div>
      </div>
    </section>

    <section>
      <div class="container">
        <div class="layout">

          <!-- LEFT: Topics -->
          <aside class="side">
            <div class="side-card">
              <div class="side-title">
                <h3>Help topics</h3>
                <span class="pill">Royal Blue</span>
              </div>
              <p class="side-desc">
                Pick one. You can browse these for free. If you want the AI to guide you through the prompt,
                upgrade to Mastery.
              </p>

              <ul class="topic-list" id="topic-list">
                <!-- populated by JS -->
              </ul>
            </div>
          </aside>

          <!-- RIGHT: Content -->
          <div class="main-card">
            <div class="main-head">
              <div class="titles">
                <div class="main-kicker" id="main-kicker">HELP TOPIC</div>
                <div class="main-title" id="main-title">Select a help topic</div>
                <div class="main-sub" id="main-sub">
                  Click a topic on the left to load an explanation and a guided prompt you can copy or run (Mastery).
                </div>
              </div>

              <div class="actions">
                <button class="btn-pill" id="copy-help-prompt" type="button" style="display:none;">Copy prompt</button>
                <button class="btn-help" id="run-help-ai" type="button" style="display:none;">Run Help with AI</button>
              </div>
            </div>

            <div class="access-strip" id="access-strip" style="display:none;">
              <div class="text" id="access-text"></div>
              <div class="actions" id="access-actions"></div>
            </div>

            <div class="content" id="content">
              <div class="info-box">
                Tip: If you arrived here from the nano-lesson panel, your URL may include an id like
                <strong>?id=ET01</strong>. That will auto-open the right topic.
              </div>

              <div class="ai-response" id="ai-response"></div>

              <div class="locked-panel" id="locked-panel">
                <div class="locked-title">Mastery required</div>
                <div class="locked-desc">
                  You can browse the help topic and copy the prompt. Running it with AI requires Mastery access.
                </div>
                <div class="locked-actions">
                  <a class="btn-primary" href="/pricing.html">Upgrade to Mastery</a>
                  <a class="btn-pill" href="/auth.html" onclick="PS_setPostAuthRedirect && PS_setPostAuthRedirect()">Sign In</a>
                </div>
              </div>
            </div>

          </div>

        </div>
      </div>
    </section>
  </main>

  <footer>© 2025 PromptSchola. All rights reserved.</footer>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="/auth.js"></script>

<script>
  // Post-auth redirect helper
  function PS_setPostAuthRedirect() {
    try {
      const path = window.location.pathname + window.location.search + window.location.hash;
      localStorage.setItem('ps_post_auth_redirect', path);
    } catch (e) {}
  }
  window.PS_setPostAuthRedirect = PS_setPostAuthRedirect;

  // -------- Help topics + prompts (royal-blue help surface) --------
  const HELP = [
    {
      id: "CL01",
      group: "Confusions & look-alikes",
      title: "Slope vs value: what the v–t graph is really telling you",
      summary: "Learn how slope and height mean different physical quantities, and stop mixing them up.",
      prompt: `You are a friendly, rigorous Physics tutor.\n\nTopic: Constant acceleration — slope vs value confusion.\n\nExplain:\n• On a velocity–time (v–t) graph, what the *value* v means and what the *slope* means\n• Give 2 quick examples where the line is above zero but slope is negative, and interpret physically\n• Connect to a–t and x–t graphs: what does slope/area mean on each?\n\nFormatting rules:\n• Short paragraphs + bullet points\n• Bold key terms sparingly\n• If you include equations, use LaTeX display math one per line\n• Do NOT use markdown headings like # or ###.`
    },
    {
      id: "CL02",
      group: "Confusions & look-alikes",
      title: "Average vs instantaneous acceleration (and why constant-a makes them match)",
      summary: "See why constant acceleration makes the average over an interval equal to the instantaneous value.",
      prompt: `You are a friendly, rigorous Physics tutor.\n\nTopic: Average vs instantaneous acceleration.\n\nExplain:\n• The difference between average acceleration and instantaneous acceleration\n• Why, if acceleration is constant, these become the same number over any time interval\n• A short numeric example showing both computations agree\n• A quick warning: what breaks when acceleration is changing (air resistance)\n\nFormatting rules:\n• Short paragraphs + bullet points\n• Bold key terms sparingly\n• LaTeX display math one per line\n• No markdown headings like # or ###.`
    },
    {
      id: "ET01",
      group: "Tricky areas & exam traps",
      title: "At the top of the throw: velocity is zero, acceleration is not",
      summary: "Fix the classic misconception that a = 0 at the top; only v becomes zero instantaneously.",
      prompt: `You are a friendly, rigorous Physics tutor.\n\nTopic: Thrown-up motion under gravity.\n\nExplain clearly:\n• At the top of the motion, why velocity is zero at an instant but acceleration is still nonzero\n• Use v–t and a–t reasoning (qualitative)\n• Provide a 3-line numeric sanity check using simple numbers\n• Give 2 common wrong statements students make and correct them\n\nFormatting rules:\n• Short paragraphs + bullet points\n• Bold key terms sparingly\n• LaTeX display math one per line\n• No markdown headings like # or ###.`
    },
    {
      id: "ET02",
      group: "Tricky areas & exam traps",
      title: "Sign conventions: choosing + upward vs + downward without confusion",
      summary: "A clean sign convention routine that prevents half the wrong answers in kinematics.",
      prompt: `You are a friendly, rigorous Physics tutor.\n\nTopic: Sign conventions in 1D constant acceleration.\n\nProvide:\n• A quick routine: choose + direction, set axis, then assign signs to u, v, a, s\n• Show the same free-fall problem solved with + up and with + down (brief), and show answers match physically\n• List 3 sign mistakes that commonly happen and how to catch them\n\nFormatting rules:\n• Short paragraphs + bullet points\n• Bold key terms sparingly\n• LaTeX display math one per line\n• No markdown headings like # or ###.`
    },
    {
      id: "CM01",
      group: "Common mistakes",
      title: "Mixing up “acceleration is constant” with “velocity is constant”",
      summary: "Constant a means v changes linearly; constant v means a = 0. Don’t swap them.",
      prompt: `You are a friendly, rigorous Physics tutor.\n\nTopic: Constant acceleration vs constant velocity.\n\nExplain:\n• What “constant acceleration” means for v(t)\n• What “constant velocity” means for a(t)\n• A table-like comparison in bullets (not an actual markdown table)\n• 2 quick conceptual questions with answers (no spoilers formatting needed)\n\nFormatting rules:\n• Short paragraphs + bullet points\n• Bold key terms sparingly\n• LaTeX display math one per line\n• No markdown headings like # or ###.`
    },
    {
      id: "CM02",
      group: "Common mistakes",
      title: "Using the wrong kinematics equation for the knowns you have",
      summary: "Pick the equation that avoids the variable you don’t know — fast and reliable.",
      prompt: `You are a friendly, rigorous Physics tutor.\n\nTopic: Choosing kinematics equations (constant a).\n\nTeach a fast method:\n• Identify the 5 variables (u, v, a, t, s)\n• Choose the equation that uses your knowns and avoids the unknown you don’t have\n• Give 3 mini-scenarios: (knowns) → (best equation) → (one-line reason)\n\nFormatting rules:\n• Short paragraphs + bullet points\n• Bold key terms sparingly\n• LaTeX display math one per line\n• No markdown headings like # or ###.`
    },
    {
      id: "ST01",
      group: "When you feel stuck",
      title: "How to draw a quick motion diagram and decide signs",
      summary: "A 15-second sketch that tells you direction, signs, and which way acceleration points.",
      prompt: `You are a friendly, rigorous Physics tutor.\n\nTopic: Getting unstuck with motion diagrams.\n\nProvide:\n• A quick “motion diagram” routine (dots/spacing/arrows)\n• How to infer sign of velocity and sign of acceleration from the diagram\n• Apply to: (1) braking car (2) thrown upward ball\n\nFormatting rules:\n• Short paragraphs + bullet points\n• Bold key terms sparingly\n• LaTeX display math one per line\n• No markdown headings like # or ###.`
    },
    {
      id: "ST02",
      group: "When you feel stuck",
      title: "Given 3 variables, how to pick the right equation in 10 seconds",
      summary: "A quick decision flow to avoid random equation hunting.",
      prompt: `You are a friendly, rigorous Physics tutor.\n\nTopic: 10-second equation choice.\n\nBuild a simple decision flow:\n• Step 1: list knowns/unknowns among u, v, a, t, s\n• Step 2: eliminate equations that require an unknown you don’t have\n• Step 3: pick the simplest remaining\n\nInclude 3 worked micro-examples (very brief): show the variable list, chosen equation, and final answer.\n\nFormatting rules:\n• Short paragraphs + bullet points\n• Bold key terms sparingly\n• LaTeX display math one per line\n• No markdown headings like # or ###.`
    },
    {
      id: "BR01",
      group: "Concept bridges",
      title: "How constant-a leads into Newton’s laws (forces cause acceleration)",
      summary: "Connect kinematics to dynamics: constant net force → constant acceleration.",
      prompt: `You are a friendly, rigorous Physics tutor.\n\nTopic: Bridge from kinematics to Newton’s laws.\n\nExplain:\n• Why constant net force implies constant acceleration (conceptual, not heavy math)\n• A short example: sliding block with kinetic friction (roughly constant force)\n• Why “changing force” often means acceleration changes\n\nFormatting rules:\n• Short paragraphs + bullet points\n• Bold key terms sparingly\n• LaTeX display math one per line (optional)\n• No markdown headings like # or ###.`
    },
    {
      id: "BR02",
      group: "Concept bridges",
      title: "How derivatives/integrals connect to v = dx/dt and a = dv/dt",
      summary: "See calculus as slope/area: it’s the same story as graphs, just formalized.",
      prompt: `You are a friendly, rigorous Physics tutor.\n\nTopic: Calculus connection to motion.\n\nExplain:\n• v is the derivative of x with respect to t; a is the derivative of v\n• Area under v–t gives displacement; area under a–t gives change in velocity\n• For constant acceleration, show why v(t) is linear and x(t) is quadratic (brief)\n\nFormatting rules:\n• Short paragraphs + bullet points\n• Bold key terms sparingly\n• LaTeX display math one per line\n• No markdown headings like # or ###.`
    }
  ];

  function getParam(name) {
    try {
      const u = new URL(window.location.href);
      return u.searchParams.get(name);
    } catch { return null; }
  }

  function setParam(name, value) {
    try {
      const u = new URL(window.location.href);
      u.searchParams.set(name, value);
      window.history.replaceState({}, '', u.toString());
    } catch {}
  }

  function formatOutput(text) {
    if (!text) return '';
    let safe = text
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;');

    safe = safe
      .replace(/\\\\\[/g, '\\[')
      .replace(/\\\\\]/g, '\\]')
      .replace(/\\\\\(/g, '\\(')
      .replace(/\\\\\)/g, '\\)');

    safe = safe.replace(/^#{1,6}\s+(.+)$/gm, '<strong>$1</strong>');
    safe = safe.replace(/^\s*[-*]\s+/gm, '• ');
    safe = safe.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
    safe = safe.replace(/\*(.+?)\*/g, '<em>$1</em>');
    safe = safe.replace(/\n\n+/g, '</p><p>');
    safe = safe.replace(/\n/g, '<br>');
    return '<p>' + safe + '</p>';
  }

  function copyText(text) {
    if (!navigator.clipboard?.writeText) return alert('Clipboard not supported in this browser.');
    navigator.clipboard.writeText(text).then(() => alert('Copied.')).catch(() => alert('Could not copy.'));
  }

  function redirectToSignupForRunAI() {
    const redirectTarget = encodeURIComponent(window.location.href);
    window.location.href = `/auth.html?mode=signup&reason=run-ai&redirect=${redirectTarget}`;
  }

  function setRunning(btn, running) {
    if (!btn) return;
    if (running) {
      btn.dataset.prevText = btn.textContent;
      btn.textContent = 'Running…';
      btn.disabled = true;
      btn.setAttribute('aria-busy', 'true');
    } else {
      btn.disabled = false;
      btn.textContent = btn.dataset.prevText || btn.textContent;
      btn.removeAttribute('aria-busy');
    }
  }

  async function runHelpWithAI(promptText, topicId) {
    const out = document.getElementById('ai-response');
    const runBtn = document.getElementById('run-help-ai');
    if (!out || !runBtn) return;

    // Require login for Run-with-AI (server enforces too)
    if (typeof ensureLoggedInOrRedirect === 'function') {
      const user = await ensureLoggedInOrRedirect();
      if (!user) return; // redirected
    } else {
      redirectToSignupForRunAI();
      return;
    }

    const token = (typeof PS_getAccessToken === 'function') ? await PS_getAccessToken() : null;
    if (!token) {
      out.textContent = 'Session missing. Please sign in again.';
      return;
    }

    setRunning(runBtn, true);

    try {
      out.textContent = 'Running with AI…';

      const res = await fetch('/api/run-step', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({
          prompt: promptText,
          step: `help-${topicId}`
        })
      });

      if (!res.ok) {
        let msg = 'There was an error contacting the AI. Please try again later.';
        try {
          const err = await res.json();
          if (err?.error) msg = err.error;
          if (err?.code === 'PAYWALL') msg = 'Running Help with AI requires Mastery (paid) access.';
          if (err?.code === 'INVALID_SESSION') msg = 'Session expired. Please sign in again.';
          if (err?.code === 'AUTH_REQUIRED') msg = 'Please sign in to run Help with AI.';
          if (err?.code === 'PROMPT_INVALID') msg = 'Prompt failed validation.';
        } catch (_) {}
        out.textContent = msg;
        return;
      }

      const data = await res.json();
      const raw = data.content || 'No response received from AI.';
      out.innerHTML = formatOutput(raw);

      if (window.MathJax?.typesetPromise) MathJax.typesetPromise([out]).catch(()=>{});
    } catch (e) {
      console.error(e);
      out.textContent = 'Unexpected error. Please try again.';
    } finally {
      setRunning(runBtn, false);
    }
  }

  function renderTopicList(selectedId) {
    const ul = document.getElementById('topic-list');
    if (!ul) return;

    ul.innerHTML = '';

    // group headings in data but keep list simple; show group in badge
    HELP.forEach(item => {
      const li = document.createElement('li');

      const a = document.createElement('a');
      a.className = 'topic-link' + (item.id === selectedId ? ' active' : '');
      a.href = `help-constant-acceleration.html?id=${encodeURIComponent(item.id)}`;
      a.addEventListener('click', (e) => {
        e.preventDefault();
        setParam('id', item.id);
        loadTopic(item.id);
      });

      const left = document.createElement('div');
      left.className = 'topic-left';

      const code = document.createElement('div');
      code.className = 'topic-code';
      code.textContent = item.id;

      const name = document.createElement('div');
      name.className = 'topic-name';
      name.textContent = item.title;

      left.appendChild(code);
      left.appendChild(name);

      const badge = document.createElement('div');
      badge.className = 'topic-badge';
      badge.textContent = item.group;

      a.appendChild(left);
      a.appendChild(badge);

      li.appendChild(a);
      ul.appendChild(li);
    });
  }

  async function configureAccessUI({ loggedIn, tier }) {
    const isPaid = tier === 'paid';
    const isFreeSignedIn = loggedIn && !isPaid;

    const strip = document.getElementById('access-strip');
    const text = document.getElementById('access-text');
    const actions = document.getElementById('access-actions');

    if (!strip || !text || !actions) return;

    strip.style.display = 'flex';
    actions.innerHTML = '';

    if (isPaid) {
      text.innerHTML = `You have <strong>Mastery</strong>. You can run Help prompts with AI.`;
      return;
    }

    if (!loggedIn) {
      text.innerHTML = `You can browse and copy prompts. To run Help with AI, <strong>sign in</strong> and upgrade to <strong>Mastery</strong>.`;
      const signIn = document.createElement('a');
      signIn.className = 'btn-pill';
      signIn.href = '/auth.html';
      signIn.textContent = 'Sign In';
      signIn.addEventListener('click', () => PS_setPostAuthRedirect && PS_setPostAuthRedirect());

      const upgrade = document.createElement('a');
      upgrade.className = 'btn-primary';
      upgrade.href = '/pricing.html';
      upgrade.textContent = 'Upgrade to Mastery';

      actions.appendChild(signIn);
      actions.appendChild(upgrade);
      return;
    }

    if (isFreeSignedIn) {
      text.innerHTML = `You’re signed in (Free). Browsing + copying is available. Running Help with AI requires <strong>Mastery</strong>.`;
      const upgrade = document.createElement('a');
      upgrade.className = 'btn-primary';
      upgrade.href = '/pricing.html';
      upgrade.textContent = 'Upgrade to Mastery';
      actions.appendChild(upgrade);
      return;
    }
  }

  async function loadTopic(topicId) {
    const item = HELP.find(x => x.id === topicId) || HELP[0];

    renderTopicList(item.id);

    const kicker = document.getElementById('main-kicker');
    const title = document.getElementById('main-title');
    const sub = document.getElementById('main-sub');
    const out = document.getElementById('ai-response');
    const copyBtn = document.getElementById('copy-help-prompt');
    const runBtn = document.getElementById('run-help-ai');
    const lockedPanel = document.getElementById('locked-panel');

    if (kicker) kicker.textContent = item.group.toUpperCase();
    if (title) title.textContent = item.title;
    if (sub) sub.textContent = item.summary;

    if (out) {
      out.innerHTML = formatOutput(
        `Use this guided prompt to resolve the issue.\n\n• You can copy it anytime.\n• Mastery users can run it directly here.\n\nPROMPT:\n${item.prompt}`
      );
      if (window.MathJax?.typesetPromise) MathJax.typesetPromise([out]).catch(()=>{});
    }

    if (copyBtn) {
      copyBtn.style.display = 'inline-flex';
      copyBtn.onclick = () => copyText(item.prompt);
    }

    // auth/tier gating for run
    let loggedIn = false;
    let tier = 'anon';

    if (typeof getCurrentUser === 'function') {
      try { loggedIn = !!(await getCurrentUser()); } catch (_) { loggedIn = false; }
    }
    if (loggedIn && typeof PS_getUserTier === 'function') {
      try { tier = await PS_getUserTier(); } catch (_) { tier = 'free'; }
      if (!tier) tier = 'free';
    }
    if (loggedIn && tier === 'anon') tier = 'free';

    await configureAccessUI({ loggedIn, tier });

    if (lockedPanel) lockedPanel.style.display = 'none';

    if (runBtn) {
      runBtn.style.display = 'inline-flex';

      if (!loggedIn) {
        runBtn.textContent = 'Run Help with AI';
        runBtn.onclick = () => redirectToSignupForRunAI();
        return;
      }

      if (tier !== 'paid') {
        runBtn.textContent = 'Run Help with AI';
        runBtn.onclick = () => {
          if (lockedPanel) lockedPanel.style.display = 'block';
          // gentle nudge: you can also jump to pricing
          // window.location.href = '/pricing.html';
        };
        return;
      }

      runBtn.textContent = 'Run Help with AI';
      runBtn.onclick = () => runHelpWithAI(item.prompt, item.id);
    }
  }

  document.addEventListener('DOMContentLoaded', async () => {
    if (typeof updateNavUserDisplay === 'function') {
      updateNavUserDisplay();
    }

    const requested = (getParam('id') || '').toUpperCase().trim();
    const initial = HELP.some(x => x.id === requested) ? requested : HELP[0].id;
    if (!getParam('id')) setParam('id', initial);

    await loadTopic(initial);
  });
</script>

</body>
</html>
